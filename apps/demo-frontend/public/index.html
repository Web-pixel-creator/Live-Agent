<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live Translator Negotiator Console</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <main class="layout">
      <header class="hero">
        <h1>Live Translator Negotiator Console</h1>
        <p class="hero-sub">
          Minimal judged-demo frontend: realtime connection, voice I/O, transcript, KPI constraints.
        </p>
      </header>

      <section class="panel">
        <h2>Connection</h2>
        <div class="grid-3">
          <label class="field">
            <span>Gateway WebSocket URL</span>
            <input id="wsUrl" type="text" value="ws://localhost:8080/realtime" />
          </label>
          <label class="field">
            <span>Session ID</span>
            <input id="sessionId" type="text" />
          </label>
          <label class="field">
            <span>User ID</span>
            <input id="userId" type="text" />
          </label>
          <label class="field">
            <span>Target Language</span>
            <input id="targetLanguage" type="text" value="ru" />
          </label>
        </div>
        <div class="actions">
          <button id="connectBtn">Connect</button>
          <button id="disconnectBtn" class="button-muted">Disconnect</button>
          <button id="newSessionBtn" class="button-muted">New Session ID</button>
        </div>
        <div class="meta-row">
          <div><strong>Status:</strong> <span id="connectionStatus">disconnected</span></div>
          <div><strong>Run ID:</strong> <span id="runId">-</span></div>
          <div><strong>User ID:</strong> <span id="currentUserId">-</span></div>
          <div><strong>Session State:</strong> <span id="sessionState">-</span></div>
          <div><strong>Mode:</strong> <span id="modeStatus">voice</span></div>
        </div>
      </section>

      <section class="panel">
        <h2>Live Controls</h2>
        <div class="actions">
          <button id="startMicBtn">Start Mic Stream</button>
          <button id="stopMicBtn" class="button-muted">Stop Mic</button>
          <button id="interruptBtn" class="button-warn">Interrupt Assistant</button>
          <button id="fallbackBtn" class="button-muted">Switch To Text Fallback</button>
        </div>
      </section>

      <section class="panel">
        <h2>Intent Request</h2>
        <div class="grid-2">
          <label class="field">
            <span>Intent</span>
            <select id="intent">
              <option value="negotiation" selected>negotiation</option>
              <option value="translation">translation</option>
              <option value="conversation">conversation</option>
              <option value="story">story</option>
              <option value="ui_task">ui_task</option>
            </select>
          </label>
          <label class="field">
            <span>User Message</span>
            <textarea id="message" rows="3">Negotiate: price=97, delivery=10, sla=99</textarea>
          </label>
        </div>
        <div class="actions">
          <button id="sendBtn">Send Request</button>
        </div>
      </section>

      <section class="panel">
        <h2>Approval Control</h2>
        <div class="grid-3">
          <label class="field">
            <span>API Backend URL</span>
            <input id="apiBaseUrl" type="text" value="http://localhost:8081" />
          </label>
          <label class="field">
            <span>Pending Approval ID</span>
            <input id="approvalId" type="text" value="-" readonly />
          </label>
          <label class="field">
            <span>Approval Reason</span>
            <input id="approvalReason" type="text" value="Approved from demo frontend" />
          </label>
        </div>
        <div class="actions">
          <button id="approveResumeBtn">Approve &amp; Resume</button>
          <button id="rejectResumeBtn" class="button-warn">Reject</button>
        </div>
        <div class="meta-row">
          <div><strong>Approval State:</strong> <span id="approvalStatus">idle</span></div>
        </div>
      </section>

      <section class="panel">
        <h2>KPI Constraints</h2>
        <div class="grid-3">
          <label class="field">
            <span>Target max price</span>
            <input id="targetPrice" type="number" value="100" />
          </label>
          <label class="field">
            <span>Target max delivery (days)</span>
            <input id="targetDelivery" type="number" value="14" />
          </label>
          <label class="field">
            <span>Target min SLA (%)</span>
            <input id="targetSla" type="number" value="98" />
          </label>
        </div>
        <div class="kpi-board">
          <article class="kpi-card">
            <h3>Current Offer</h3>
            <p>Price: <span id="currentPrice">-</span></p>
            <p>Delivery: <span id="currentDelivery">-</span></p>
            <p>SLA: <span id="currentSla">-</span></p>
          </article>
          <article class="kpi-card">
            <h3>Final Offer</h3>
            <p>Price: <span id="finalPrice">-</span></p>
            <p>Delivery: <span id="finalDelivery">-</span></p>
            <p>SLA: <span id="finalSla">-</span></p>
          </article>
          <article class="kpi-card">
            <h3>Constraint Status</h3>
            <p id="constraintStatus" class="status-pill status-neutral">Waiting for offer</p>
            <p id="fallbackAssetStatus" class="status-pill status-neutral">fallback_asset=false</p>
          </article>
        </div>
      </section>

      <section class="panel">
        <h2>Active Tasks</h2>
        <div class="actions">
          <button id="refreshTasksBtn" class="button-muted">Refresh Active Tasks</button>
        </div>
        <div class="meta-row">
          <div><strong>Active count:</strong> <span id="activeTaskCount">0</span></div>
        </div>
        <div id="tasks" class="events"></div>
      </section>

      <section class="panel">
        <h2>Operator Console</h2>
        <div class="grid-3">
          <label class="field">
            <span>Operator Role</span>
            <select id="operatorRole">
              <option value="operator" selected>operator</option>
              <option value="admin">admin</option>
              <option value="viewer">viewer</option>
            </select>
          </label>
          <label class="field">
            <span>Task ID</span>
            <input id="operatorTaskId" type="text" placeholder="task-..." />
          </label>
          <label class="field">
            <span>Target Service</span>
            <select id="operatorTargetService">
              <option value="realtime-gateway" selected>realtime-gateway</option>
              <option value="orchestrator">orchestrator</option>
              <option value="api-backend">api-backend</option>
              <option value="ui-executor">ui-executor</option>
            </select>
          </label>
        </div>
        <div class="actions">
          <button id="operatorRefreshBtn" class="button-muted">Refresh Summary</button>
          <button id="operatorCancelBtn" class="button-warn">Cancel Task</button>
          <button id="operatorRetryBtn" class="button-muted">Retry Task</button>
          <button id="operatorDrainBtn" class="button-warn">Failover Drain</button>
          <button id="operatorWarmupBtn" class="button-muted">Failover Warmup</button>
        </div>
        <div class="operator-health-board">
          <article class="operator-health-card">
            <h3>Live Bridge Status</h3>
            <p id="operatorHealthStatus" class="status-pill status-neutral">no_data</p>
            <p class="operator-health-row">
              <strong>State</strong>
              <span id="operatorHealthState">unknown</span>
            </p>
            <p class="operator-health-row">
              <strong>Last Event</strong>
              <span id="operatorHealthLastEventType">-</span>
            </p>
            <p class="operator-health-row">
              <strong>Last Event At</strong>
              <span id="operatorHealthLastEventAt">-</span>
            </p>
            <p id="operatorHealthHint" class="operator-health-hint operator-health-hint-neutral">
              Refresh summary to evaluate recovery actions.
            </p>
          </article>
          <article class="operator-health-card">
            <h3>Errors & Recovery</h3>
            <p class="operator-health-row"><strong>Degraded</strong><span id="operatorHealthDegraded">0</span></p>
            <p class="operator-health-row"><strong>Recovered</strong><span id="operatorHealthRecovered">0</span></p>
            <p class="operator-health-row">
              <strong>Watchdog Reconnects</strong>
              <span id="operatorHealthWatchdogReconnects">0</span>
            </p>
            <p class="operator-health-row"><strong>Errors</strong><span id="operatorHealthErrors">0</span></p>
            <p class="operator-health-row"><strong>Unavailable</strong><span id="operatorHealthUnavailable">0</span></p>
            <p class="operator-health-row">
              <strong>Connect Timeouts</strong>
              <span id="operatorHealthConnectTimeouts">0</span>
            </p>
          </article>
          <article class="operator-health-card">
            <h3>Probe Telemetry</h3>
            <p class="operator-health-row"><strong>Probes</strong><span id="operatorHealthProbes">0</span></p>
            <p class="operator-health-row"><strong>Ping Sent</strong><span id="operatorHealthPingSent">0</span></p>
            <p class="operator-health-row"><strong>Pongs</strong><span id="operatorHealthPongs">0</span></p>
            <p class="operator-health-row"><strong>Ping Errors</strong><span id="operatorHealthPingErrors">0</span></p>
            <p class="operator-health-row">
              <strong>Probe Success</strong>
              <span id="operatorHealthProbeSuccess">n/a</span>
            </p>
          </article>
          <article class="operator-health-card">
            <h3>UI Executor Failover</h3>
            <p id="operatorUiExecutorStatus" class="status-pill status-neutral">no_data</p>
            <p class="operator-health-row">
              <strong>State</strong>
              <span id="operatorUiExecutorState">unknown</span>
            </p>
            <p class="operator-health-row">
              <strong>Healthy</strong>
              <span id="operatorUiExecutorHealthy">unknown</span>
            </p>
            <p class="operator-health-row">
              <strong>Profile</strong>
              <span id="operatorUiExecutorProfile">n/a</span>
            </p>
            <p class="operator-health-row">
              <strong>Version</strong>
              <span id="operatorUiExecutorVersion">n/a</span>
            </p>
            <p class="operator-health-row">
              <strong>Last Action</strong>
              <span id="operatorUiExecutorLastAction">-</span>
            </p>
            <p class="operator-health-row">
              <strong>Last Outcome</strong>
              <span id="operatorUiExecutorLastOutcome">-</span>
            </p>
            <p id="operatorUiExecutorHint" class="operator-health-hint operator-health-hint-neutral">
              Refresh summary to inspect ui-executor failover state.
            </p>
          </article>
          <article class="operator-health-card">
            <h3>Device Nodes Health</h3>
            <p id="operatorDeviceNodesStatus" class="status-pill status-neutral">no_data</p>
            <p class="operator-health-row">
              <strong>Total</strong>
              <span id="operatorDeviceNodesTotal">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Online</strong>
              <span id="operatorDeviceNodesOnline">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Degraded</strong>
              <span id="operatorDeviceNodesDegraded">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Offline</strong>
              <span id="operatorDeviceNodesOffline">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Stale</strong>
              <span id="operatorDeviceNodesStale">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Missing Heartbeat</strong>
              <span id="operatorDeviceNodesMissingHeartbeat">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Max Age</strong>
              <span id="operatorDeviceNodesMaxAge">n/a</span>
            </p>
            <p id="operatorDeviceNodesHint" class="operator-health-hint operator-health-hint-neutral">
              Refresh summary to inspect device-node fleet health.
            </p>
          </article>
          <article class="operator-health-card">
            <h3>Trace Coverage</h3>
            <p id="operatorTraceStatus" class="status-pill status-neutral">no_data</p>
            <p class="operator-health-row">
              <strong>Runs</strong>
              <span id="operatorTraceRuns">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Events</strong>
              <span id="operatorTraceEvents">0</span>
            </p>
            <p class="operator-health-row">
              <strong>UI Runs</strong>
              <span id="operatorTraceUiRuns">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Approval Linked</strong>
              <span id="operatorTraceApprovals">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Trace Steps</strong>
              <span id="operatorTraceSteps">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Screenshots</strong>
              <span id="operatorTraceScreenshots">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Top Route</strong>
              <span id="operatorTraceTopRoute">n/a</span>
            </p>
            <p class="operator-health-row">
              <strong>Top Status</strong>
              <span id="operatorTraceTopStatus">n/a</span>
            </p>
            <p id="operatorTraceHint" class="operator-health-hint operator-health-hint-neutral">
              Refresh summary to inspect operator trace coverage.
            </p>
          </article>
          <article class="operator-health-card">
            <h3>Approvals Queue</h3>
            <p id="operatorApprovalsStatus" class="status-pill status-neutral">no_data</p>
            <p class="operator-health-row">
              <strong>Total</strong>
              <span id="operatorApprovalsTotal">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Pending</strong>
              <span id="operatorApprovalsPending">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Approved</strong>
              <span id="operatorApprovalsApproved">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Rejected</strong>
              <span id="operatorApprovalsRejected">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Timeout</strong>
              <span id="operatorApprovalsTimeout">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Pending from Tasks</strong>
              <span id="operatorApprovalsPendingFromTasks">0</span>
            </p>
            <p class="operator-health-row">
              <strong>SLA Soft/Hard</strong>
              <span id="operatorApprovalsSla">0 / 0</span>
            </p>
            <p class="operator-health-row">
              <strong>Latest</strong>
              <span id="operatorApprovalsLatest">n/a</span>
            </p>
            <p id="operatorApprovalsHint" class="operator-health-hint operator-health-hint-neutral">
              Refresh summary to inspect approval backlog and SLA timeouts.
            </p>
          </article>
          <article class="operator-health-card">
            <h3>Service Lifecycle</h3>
            <p id="operatorLifecycleStatus" class="status-pill status-neutral">no_data</p>
            <p class="operator-health-row">
              <strong>Ready</strong>
              <span id="operatorLifecycleReady">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Draining</strong>
              <span id="operatorLifecycleDraining">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Unknown</strong>
              <span id="operatorLifecycleUnknown">0</span>
            </p>
            <p class="operator-health-row">
              <strong>Last Change</strong>
              <span id="operatorLifecycleLastChange">n/a</span>
            </p>
            <p class="operator-health-row">
              <strong>Draining Services</strong>
              <span id="operatorLifecycleDrainingServices">none</span>
            </p>
            <p id="operatorLifecycleHint" class="operator-health-hint operator-health-hint-neutral">
              Refresh summary to inspect runtime lifecycle states.
            </p>
          </article>
        </div>
        <div id="operatorSummary" class="events"></div>
      </section>

      <section class="panel">
        <h2>Device Nodes</h2>
        <div class="grid-3">
          <label class="field">
            <span>Node ID</span>
            <input id="deviceNodeId" type="text" placeholder="desktop-main" />
          </label>
          <label class="field">
            <span>Display Name</span>
            <input id="deviceNodeDisplayName" type="text" placeholder="Desktop Main" />
          </label>
          <label class="field">
            <span>Kind</span>
            <select id="deviceNodeKind">
              <option value="desktop" selected>desktop</option>
              <option value="mobile">mobile</option>
            </select>
          </label>
          <label class="field">
            <span>Platform</span>
            <input id="deviceNodePlatform" type="text" placeholder="windows-11" />
          </label>
          <label class="field">
            <span>Executor URL</span>
            <input id="deviceNodeExecutorUrl" type="text" placeholder="http://localhost:8090/execute" />
          </label>
          <label class="field">
            <span>Status</span>
            <select id="deviceNodeStatus">
              <option value="online" selected>online</option>
              <option value="degraded">degraded</option>
              <option value="offline">offline</option>
            </select>
          </label>
          <label class="field">
            <span>Trust Level</span>
            <select id="deviceNodeTrustLevel">
              <option value="reviewed" selected>reviewed</option>
              <option value="trusted">trusted</option>
              <option value="untrusted">untrusted</option>
            </select>
          </label>
          <label class="field">
            <span>Expected Version (optional)</span>
            <input id="deviceNodeExpectedVersion" type="number" min="1" step="1" placeholder="auto" />
          </label>
          <label class="field">
            <span>Capabilities (comma-separated)</span>
            <input id="deviceNodeCapabilities" type="text" placeholder="screen,click,type,scroll" />
          </label>
        </div>
        <div class="grid-2">
          <label class="field">
            <span>Heartbeat Metadata (JSON, optional)</span>
            <textarea id="deviceNodeMetadata" rows="3" placeholder='{"os":"windows","battery":97}'></textarea>
          </label>
          <div class="field">
            <span>Quick Notes</span>
            <div class="meta-box">
              Use `admin` role for create/update and `operator/admin` for heartbeat.
            </div>
          </div>
        </div>
        <div class="actions">
          <button id="deviceNodeRefreshBtn" class="button-muted">Refresh Nodes</button>
          <button id="deviceNodeUpsertBtn">Create / Update Node</button>
          <button id="deviceNodeConflictBtn" class="button-muted">Probe Stale Conflict</button>
          <button id="deviceNodeHeartbeatBtn" class="button-muted">Send Heartbeat</button>
          <button id="deviceNodeStatusBtn" class="button-muted">Check Status</button>
        </div>
        <div class="meta-row">
          <div><strong>Total Nodes:</strong> <span id="deviceNodeCount">0</span></div>
          <div><strong>Selected Status:</strong> <span id="deviceNodeSelectedStatus">-</span></div>
          <div><strong>Selected Version:</strong> <span id="deviceNodeSelectedVersion">-</span></div>
          <div><strong>Last Seen:</strong> <span id="deviceNodeSelectedLastSeen">-</span></div>
        </div>
        <div id="deviceNodeList" class="events"></div>
      </section>

      <section class="panel">
        <h2>Transcript</h2>
        <div id="transcript" class="transcript"></div>
      </section>

      <section class="panel">
        <h2>Event Log</h2>
        <div id="events" class="events"></div>
      </section>
    </main>

    <script type="module" src="/app.js"></script>
  </body>
</html>
